<script>
  const audio = document.getElementById('audio');
  const btn = document.getElementById('playMusic');

  let celebrationMode = false;

  btn.addEventListener('click', () => {
    audio.play();
    celebrationMode = true;
    launchConfetti();
    intensifyHearts();
    pulseBackground();
  });

  /* ================= HEARTS ================= */
  const hearts = [];
  let heartCount = 70;

  function createHeart() {
    const heart = document.createElement('div');
    heart.className = 'heart';
    document.body.appendChild(heart);
    return {
      el: heart,
      speed: 0.6 + Math.random() * 1.5,
      xSpeed: (Math.random() - 0.5) * 2,
      x: Math.random() * window.innerWidth,
      y: window.innerHeight + Math.random() * 100
    };
  }

  for (let i = 0; i < heartCount; i++) {
    hearts.push(createHeart());
  }

  function createTrail(x, y) {
    const t = document.createElement('div');
    t.className = 'trail';
    t.style.left = x + 'px';
    t.style.top = y + 'px';
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 500);
  }

  function animateHearts() {
    hearts.forEach(h => {
      h.y -= h.speed;
      h.x += h.xSpeed;

      createTrail(h.x, h.y);

      if (h.y < -40) {
        h.y = window.innerHeight + Math.random() * 80;
        h.x = Math.random() * window.innerWidth;
      }

      h.el.style.top = h.y + 'px';
      h.el.style.left = h.x + 'px';
    });
    requestAnimationFrame(animateHearts);
  }

  animateHearts();

  function intensifyHearts() {
    setInterval(() => {
      if (hearts.length < 160) {
        hearts.push(createHeart());
      }
    }, 300);
  }

  /* ================= CONFETTI FIREWORKS ================= */
  function launchConfetti() {
    for (let i = 0; i < 120; i++) {
      const c = document.createElement('div');
      c.className = 'confetti';
      c.style.left = window.innerWidth / 2 + 'px';
      c.style.top = window.innerHeight / 2 + 'px';
      document.body.appendChild(c);

      let angle = Math.random() * Math.PI * 2;
      let speed = 2 + Math.random() * 5;
      let vx = Math.cos(angle) * speed;
      let vy = Math.sin(angle) * speed;
      let rot = Math.random() * 360;

      const anim = setInterval(() => {
        let x = parseFloat(c.style.left);
        let y = parseFloat(c.style.top);

        c.style.left = x + vx + 'px';
        c.style.top = y + vy + 'px';
        c.style.transform = `rotate(${rot += 5}deg)`;

        createTrail(x, y);
        vy += 0.08;

        if (y > window.innerHeight || x < 0 || x > window.innerWidth) {
          clearInterval(anim);
          c.remove();
        }
      }, 16);
    }
  }

  /* ================= BACKGROUND PULSE ================= */
  function pulseBackground() {
    let intensity = 0;
    setInterval(() => {
      intensity += 0.02;
      document.body.style.background =
        `radial-gradient(circle at center,
        rgba(255,200,220,${0.4 + Math.sin(intensity) * 0.2}),
        #ffe6f2)`;
    }, 50);
  }

  /* ================= RESIZE FIX ================= */
  window.addEventListener('resize', () => {
    hearts.forEach(h => {
      h.x = Math.min(h.x, window.innerWidth - 20);
      h.y = Math.min(h.y, window.innerHeight - 20);
    });
  });
</script>
